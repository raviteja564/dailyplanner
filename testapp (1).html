<!DOCTYPE html>
<html>
<head>
    <title>Daily Planner For Monica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: auto; }
        .task-container { margin-bottom: 20px; }
        .task-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .task-table th, .task-table td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        .task-table th { background: #f5f5f5; }
        .task-table td { vertical-align: middle; }
        input[type="text"] { padding: 8px; width: 100%; box-sizing: border-box; }
        select { padding: 8px; width: 100%; box-sizing: border-box; }
        button { padding: 8px 15px; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .today-button { background: #4CAF50; } /* Green for Today button */
        .nav-button { background: #FF9800; } /* Orange for Previous/Next buttons */
        .delete-button { background: #ff4444; } /* Red for Delete button */
        .calendar { margin: 20px 0; }
        .calendar div { padding: 10px; text-align: center; border: 1px solid #ddd; cursor: pointer; }
        .calendar div.today { background: #4CAF50; color: white; }
        .calendar div.selected { background: #2196F3; color: white; }
        .expiry-selector { margin: 10px 0; }
        .navigation { display: flex; justify-content: space-between; margin: 10px 0; }
        .completed-task { background: #e8f5e9; } /* Light green for completed tasks */
        .skipped-task { background: #fff3e0; } /* Light orange for skipped tasks */
        .delete-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ddd; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); z-index: 1000; }
        .delete-popup button { margin: 5px; }
        .graph-container { margin-top: 40px; }
        .graph-container div { margin-bottom: 40px; }
        #auth-container { max-width: 300px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        #login-form, #signup-form { display: flex; flex-direction: column; gap: 10px; }
        #app { display: none; } /* Hide the app until the user logs in */
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div id="auth-container">
        <!-- Login Form -->
        <div id="login-form">
            <h2>Login</h2>
            <input type="email" id="loginEmail" placeholder="Email">
            <input type="password" id="loginPassword" placeholder="Password">
            <button onclick="login()">Login</button>
            <p>Don't have an account? <a href="#" onclick="showSignUp()">Sign Up</a></p>
        </div>

        <!-- Sign-Up Form -->
        <div id="signup-form" style="display: none;">
            <h2>Sign Up</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button onclick="signUp()">Sign Up</button>
            <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
    </div>

    <!-- Main App (Hidden Initially) -->
    <div id="app">
        <h1>Daily Planner exclusively for MONICA</h1>

        <!-- Task Input -->
        <div class="task-container">
            <input type="text" id="taskInput" placeholder="Enter task...">
            <div class="expiry-selector">
                <label for="expiryDate">Expiry Date:</label>
                <input type="date" id="expiryDate" min="">
            </div>
            <button onclick="addTask()">Add Task</button>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-button" onclick="previous()">Previous</button>
            <span id="currentRange"></span>
            <button class="nav-button" onclick="next()">Next</button>
            <button class="today-button" onclick="highlightToday()">Today</button>
        </div>

        <!-- Calendar -->
        <div class="calendar" id="calendar"></div>

        <!-- Task List -->
        <table class="task-table" id="taskTable">
            <thead>
                <tr>
                    <th>Task</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tasksList"></tbody>
        </table>

        <!-- Delete Popup -->
        <div class="delete-popup" id="deletePopup">
            <p>Are you sure you want to delete this task?</p>
            <button onclick="deleteForToday()">Delete for Today</button>
            <button onclick="deleteCompletely()">Delete Completely</button>
            <button onclick="closeDeletePopup()">Cancel</button>
        </div>

        <!-- Graphs -->
        <div class="graph-container">
            <div>
                <h2>Weekly Status</h2>
                <canvas id="weeklyChart"></canvas>
            </div>
            <div>
                <h2>Monthly Status</h2>
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js"></script>

    <script>
        // Firebase configuration (replace with your own values)
        import { initializeApp } from "firebase/app";
        import { getAnalytics } from "firebase/analytics";
        const firebaseConfig = {
            apiKey: "AIzaSyCVG1dE9X5b3YAX_tG_XKc01pKx-SlC-v0",
            authDomain: "dailyplanner-e9f7d.firebaseapp.com",
            projectId: "dailyplanner-e9f7d",
            storageBucket: "dailyplanner-e9f7d.firebasestorage.app",
            messagingSenderId: "1037126520",
            appId: "1:1037126520:web:ce7031339a68723991968d",
            measurementId: "G-CJ2T8M13Z7"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); // For authentication
        const db = firebase.firestore(); // For Firestore database

        // Toggle between login and sign-up forms
        function showSignUp() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('signup-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        }
    

        // Sign-Up Function
        function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert('User created successfully!');
                    showLogin(); // Switch to login form after sign-up
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        // Login Function
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert('Logged in successfully!');
                    document.getElementById('auth-container').style.display = 'none'; // Hide auth container
                    document.getElementById('app').style.display = 'block'; // Show the app
                    loadDay(new Date().toLocaleDateString('en-CA')); // Load tasks for today
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        // Logout Function
        function logout() {
            auth.signOut()
                .then(() => {
                    alert('Logged out successfully!');
                    document.getElementById('auth-container').style.display = 'block'; // Show auth container
                    document.getElementById('app').style.display = 'none'; // Hide the app
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        // Task Management Functions (from your original code)
        let plannerData = JSON.parse(localStorage.getItem('plannerData')) || { days: [] };
        let currentDate = new Date().toLocaleDateString('en-CA'); // Use local time in YYYY-MM-DD format
        let currentStartDate = new Date(); // Start date for day view (local time)
        let deleteTaskId = null; // Track task to delete

        // Initialize current day
        if (!plannerData.days.some(day => day.date === currentDate)) {
            plannerData.days.push({
                date: currentDate,
                tasks: []
            });
            saveData();
        }

        // Set minimum expiry date to today
        document.getElementById('expiryDate').min = currentDate;

        // Load initial data
        renderCalendar();
        loadDay(currentDate);
        renderCharts();

        function addTask() {
            const input = document.getElementById('taskInput');
            const expiryDate = document.getElementById('expiryDate').value;
            const taskName = input.value.trim();
            
            if (taskName && expiryDate) {
                const taskId = Date.now();
                const startDate = new Date(currentDate);
                const endDate = new Date(expiryDate);

                // Add task to all days from today to expiry date
                while (startDate <= endDate) {
                    const dateStr = startDate.toISOString().split('T')[0];
                    let day = plannerData.days.find(day => day.date === dateStr);
                    
                    if (!day) {
                        day = { date: dateStr, tasks: [] };
                        plannerData.days.push(day);
                    }

                    // Add task if it doesn't already exist
                    if (!day.tasks.some(task => task.id === taskId)) {
                        day.tasks.push({
                            id: taskId,
                            name: taskName,
                            status: 'pending', // Default status
                            notes: ''
                        });
                    }

                    startDate.setDate(startDate.getDate() + 1); // Move to next day
                }

                saveData();
                input.value = '';
                loadDay(currentDate);
                renderCharts();
            } else {
                alert("Please enter a task and select an expiry date.");
            }
        }

        // Rest of your task management functions...
    </script>
</body>
</html>
